<!doctype html>
<html lang='en'>
<head>
    <title>Extra Credit 2</title>
</head>
<body>
    <button id="mello">Mellow Music</button>
    <button id="rammstein">Fricken Rammstein</button>
</body>
<script>
    const startMello = function() {
        document.body.innerHTML = ''
        const canvas = document.createElement( 'canvas' )
        document.body.appendChild( canvas )
        canvas.width = canvas.height = 512
        const ctx = canvas.getContext( '2d' )

        // audio init
        const audioCtx = new AudioContext()
        const audioElement = document.createElement( 'audio' )
        document.body.appendChild( audioElement )

        // audio graph setup
        const analyser = audioCtx.createAnalyser()
        analyser.fftSize = 1024 // 512 bins
        const player = audioCtx.createMediaElementSource( audioElement )
        player.connect( audioCtx.destination )
        player.connect( analyser )

        audioElement.src = 'media/mello.mp3';
        audioElement.play()

        const results = new Uint8Array( analyser.frequencyBinCount )

        draw = function() {
            // temporal recursion, call tthe function in the future
            window.requestAnimationFrame( draw )

            ctx.fillStyle = 'black'
            ctx.fillRect( 0,0,canvas.width,canvas.height )
            ctx.fillStyle = 'white'

            analyser.getByteFrequencyData( results )

            for( let i = 0; i < analyser.frequencyBinCount; i++ ) {
                ctx.fillRect( i, 0, 1, results[i] ) // upside down
            }
        }
        draw()
    }

    const startRamm = function() {
        document.body.innerHTML = ''
        const canvas = document.createElement( 'canvas' )
        document.body.appendChild( canvas )
        canvas.width = canvas.height = 512
        const ctx = canvas.getContext( '2d' )

        // audio init
        const audioCtx = new AudioContext()
        const audioElement = document.createElement( 'audio' )
        document.body.appendChild( audioElement )

        // audio graph setup
        const analyser = audioCtx.createAnalyser()
        analyser.fftSize = 1024 // 512 bins
        const player = audioCtx.createMediaElementSource( audioElement )
        player.connect( audioCtx.destination )
        player.connect( analyser )

        audioElement.src = 'media/deutschland.mp3';
        audioElement.play()

        const results = new Uint8Array( analyser.frequencyBinCount )

        draw = function() {
            // temporal recursion, call tthe function in the future
            window.requestAnimationFrame( draw )

            ctx.fillStyle = 'black'
            ctx.fillRect( 0,0,canvas.width,canvas.height )
            ctx.fillStyle = 'white'

            analyser.getByteFrequencyData( results )

            for( let i = 0; i < analyser.frequencyBinCount; i++ ) {
                ctx.fillRect( i, 0, 1, results[i] ) // upside down
            }
        }
        draw()
    }

    window.onload = function() {
        document.getElementById('mello').onclick = startMello;
        document.getElementById('rammstein').onclick = startRamm;
    }
</script>
</html>